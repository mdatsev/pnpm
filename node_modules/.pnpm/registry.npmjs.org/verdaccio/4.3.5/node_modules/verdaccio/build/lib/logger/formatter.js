"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.printMessage = printMessage;
exports.fillInMsgTemplate = fillInMsgTemplate;

var _util = require("util");

var _utils = require("../utils");

var _kleur = require("kleur");

var _levels = require("./levels");

let LEVEL_VALUE_MAX = 0;

for (const l in _levels.levels) {
  if (Object.prototype.hasOwnProperty.call(_levels.levels, l)) {
    LEVEL_VALUE_MAX = Math.max(LEVEL_VALUE_MAX, l.length);
  }
}
/**
 * Apply colors to a string based on level parameters.
 * @param {*} type
 * @param {*} msg
 * @param {*} templateObjects
 * @param {*} hasColors
 * @return {String}
 */


function printMessage(type, msg, templateObjects, hasColors) {
  if (typeof type === 'number') {
    type = (0, _levels.calculateLevel)(type);
  }

  const finalMessage = fillInMsgTemplate(msg, templateObjects, hasColors);
  const sub = _levels.subsystems[hasColors ? 0 : 1][templateObjects.sub] || _levels.subsystems[+!hasColors].default;

  if (hasColors) {
    return ` ${_levels.levels[type]((0, _utils.pad)(type, LEVEL_VALUE_MAX))}${(0, _kleur.white)(`${sub} ${finalMessage}`)}`;
  } else {
    return ` ${(0, _utils.pad)(type, LEVEL_VALUE_MAX)}${sub} ${finalMessage}`;
  }
}

function fillInMsgTemplate(msg, obj, colors) {
  return msg.replace(/@{(!?[$A-Za-z_][$0-9A-Za-z\._]*)}/g, (_, name) => {
    let str = obj;
    let is_error;

    if (name[0] === '!') {
      name = name.substr(1);
      is_error = true;
    }

    const _ref = name.split('.');

    for (let _i = 0; _i < _ref.length; _i++) {
      const id = _ref[_i];

      if ((0, _utils.isObject)(str)) {
        // @ts-ignore
        str = str[id];
      } else {
        str = undefined;
      }
    }

    if (typeof str === 'string') {
      if (!colors || str.includes('\n')) {
        return str;
      } else if (is_error) {
        return (0, _kleur.red)(str);
      } else {
        return (0, _kleur.green)(str);
      }
    } else {
      return (0, _util.inspect)(str, undefined, null, colors);
    }
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9saWIvbG9nZ2VyL2Zvcm1hdHRlci50cyJdLCJuYW1lcyI6WyJMRVZFTF9WQUxVRV9NQVgiLCJsIiwibGV2ZWxzIiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiTWF0aCIsIm1heCIsImxlbmd0aCIsInByaW50TWVzc2FnZSIsInR5cGUiLCJtc2ciLCJ0ZW1wbGF0ZU9iamVjdHMiLCJoYXNDb2xvcnMiLCJmaW5hbE1lc3NhZ2UiLCJmaWxsSW5Nc2dUZW1wbGF0ZSIsInN1YiIsInN1YnN5c3RlbXMiLCJkZWZhdWx0Iiwib2JqIiwiY29sb3JzIiwicmVwbGFjZSIsIl8iLCJuYW1lIiwic3RyIiwiaXNfZXJyb3IiLCJzdWJzdHIiLCJfcmVmIiwic3BsaXQiLCJfaSIsImlkIiwidW5kZWZpbmVkIiwiaW5jbHVkZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7O0FBR0E7O0FBRUEsSUFBSUEsZUFBZSxHQUFHLENBQXRCOztBQUNBLEtBQUssTUFBTUMsQ0FBWCxJQUFnQkMsY0FBaEIsRUFBd0I7QUFDdEIsTUFBSUMsTUFBTSxDQUFDQyxTQUFQLENBQWlCQyxjQUFqQixDQUFnQ0MsSUFBaEMsQ0FBcUNKLGNBQXJDLEVBQTZDRCxDQUE3QyxDQUFKLEVBQXFEO0FBQ25ERCxJQUFBQSxlQUFlLEdBQUdPLElBQUksQ0FBQ0MsR0FBTCxDQUFTUixlQUFULEVBQTBCQyxDQUFDLENBQUNRLE1BQTVCLENBQWxCO0FBQ0Q7QUFDRjtBQUVEOzs7Ozs7Ozs7O0FBUU8sU0FBU0MsWUFBVCxDQUFzQkMsSUFBdEIsRUFBNEJDLEdBQTVCLEVBQWlDQyxlQUFqQyxFQUFrREMsU0FBbEQsRUFBNkQ7QUFDbEUsTUFBSSxPQUFPSCxJQUFQLEtBQWdCLFFBQXBCLEVBQThCO0FBQzVCQSxJQUFBQSxJQUFJLEdBQUcsNEJBQWVBLElBQWYsQ0FBUDtBQUNEOztBQUVELFFBQU1JLFlBQVksR0FBR0MsaUJBQWlCLENBQUNKLEdBQUQsRUFBTUMsZUFBTixFQUF1QkMsU0FBdkIsQ0FBdEM7QUFFQSxRQUFNRyxHQUFHLEdBQUdDLG1CQUFXSixTQUFTLEdBQUcsQ0FBSCxHQUFPLENBQTNCLEVBQThCRCxlQUFlLENBQUNJLEdBQTlDLEtBQXNEQyxtQkFBVyxDQUFDLENBQUNKLFNBQWIsRUFBd0JLLE9BQTFGOztBQUNBLE1BQUlMLFNBQUosRUFBZTtBQUNiLFdBQVEsSUFBR1osZUFBT1MsSUFBUCxFQUFhLGdCQUFJQSxJQUFKLEVBQVVYLGVBQVYsQ0FBYixDQUF5QyxHQUFFLGtCQUFPLEdBQUVpQixHQUFJLElBQUdGLFlBQWEsRUFBN0IsQ0FBZ0MsRUFBdEY7QUFDRCxHQUZELE1BRU87QUFDTCxXQUFRLElBQUcsZ0JBQUlKLElBQUosRUFBVVgsZUFBVixDQUEyQixHQUFFaUIsR0FBSSxJQUFHRixZQUFhLEVBQTVEO0FBQ0Q7QUFDRjs7QUFFTSxTQUFTQyxpQkFBVCxDQUEyQkosR0FBM0IsRUFBZ0NRLEdBQWhDLEVBQThDQyxNQUE5QyxFQUE4RDtBQUNuRSxTQUFPVCxHQUFHLENBQUNVLE9BQUosQ0FBWSxvQ0FBWixFQUFrRCxDQUFDQyxDQUFELEVBQUlDLElBQUosS0FBcUI7QUFFNUUsUUFBSUMsR0FBRyxHQUFHTCxHQUFWO0FBQ0EsUUFBSU0sUUFBSjs7QUFDQSxRQUFJRixJQUFJLENBQUMsQ0FBRCxDQUFKLEtBQVksR0FBaEIsRUFBcUI7QUFDbkJBLE1BQUFBLElBQUksR0FBR0EsSUFBSSxDQUFDRyxNQUFMLENBQVksQ0FBWixDQUFQO0FBQ0FELE1BQUFBLFFBQVEsR0FBRyxJQUFYO0FBQ0Q7O0FBRUQsVUFBTUUsSUFBSSxHQUFHSixJQUFJLENBQUNLLEtBQUwsQ0FBVyxHQUFYLENBQWI7O0FBQ0EsU0FBSyxJQUFJQyxFQUFFLEdBQUcsQ0FBZCxFQUFpQkEsRUFBRSxHQUFHRixJQUFJLENBQUNuQixNQUEzQixFQUFtQ3FCLEVBQUUsRUFBckMsRUFBeUM7QUFDdkMsWUFBTUMsRUFBRSxHQUFHSCxJQUFJLENBQUNFLEVBQUQsQ0FBZjs7QUFDQSxVQUFJLHFCQUFTTCxHQUFULENBQUosRUFBbUI7QUFDakI7QUFDQUEsUUFBQUEsR0FBRyxHQUFHQSxHQUFHLENBQUNNLEVBQUQsQ0FBVDtBQUNELE9BSEQsTUFHTztBQUNMTixRQUFBQSxHQUFHLEdBQUdPLFNBQU47QUFDRDtBQUNGOztBQUVELFFBQUksT0FBT1AsR0FBUCxLQUFlLFFBQW5CLEVBQTZCO0FBQzNCLFVBQUksQ0FBQ0osTUFBRCxJQUFZSSxHQUFELENBQWdCUSxRQUFoQixDQUF5QixJQUF6QixDQUFmLEVBQStDO0FBQzdDLGVBQU9SLEdBQVA7QUFDRCxPQUZELE1BRU8sSUFBSUMsUUFBSixFQUFjO0FBQ25CLGVBQU8sZ0JBQUlELEdBQUosQ0FBUDtBQUNELE9BRk0sTUFFQTtBQUNMLGVBQU8sa0JBQU1BLEdBQU4sQ0FBUDtBQUNEO0FBQ0YsS0FSRCxNQVFPO0FBQ0wsYUFBTyxtQkFBUUEsR0FBUixFQUFhTyxTQUFiLEVBQXdCLElBQXhCLEVBQThCWCxNQUE5QixDQUFQO0FBQ0Q7QUFDRixHQS9CTSxDQUFQO0FBZ0NEIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgaW5zcGVjdCB9IGZyb20gJ3V0aWwnO1xuaW1wb3J0IHsgaXNPYmplY3QsIHBhZCB9IGZyb20gJy4uL3V0aWxzJztcbmltcG9ydCB7IHJlZCwgZ3JlZW4gfSBmcm9tICdrbGV1cic7XG5cbmltcG9ydCB7IHdoaXRlIH0gZnJvbSAna2xldXInO1xuaW1wb3J0IHtjYWxjdWxhdGVMZXZlbCwgbGV2ZWxzLCBzdWJzeXN0ZW1zfSBmcm9tIFwiLi9sZXZlbHNcIjtcblxubGV0IExFVkVMX1ZBTFVFX01BWCA9IDA7XG5mb3IgKGNvbnN0IGwgaW4gbGV2ZWxzKSB7XG4gIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwobGV2ZWxzLCBsKSkge1xuICAgIExFVkVMX1ZBTFVFX01BWCA9IE1hdGgubWF4KExFVkVMX1ZBTFVFX01BWCwgbC5sZW5ndGgpO1xuICB9XG59XG5cbi8qKlxuICogQXBwbHkgY29sb3JzIHRvIGEgc3RyaW5nIGJhc2VkIG9uIGxldmVsIHBhcmFtZXRlcnMuXG4gKiBAcGFyYW0geyp9IHR5cGVcbiAqIEBwYXJhbSB7Kn0gbXNnXG4gKiBAcGFyYW0geyp9IHRlbXBsYXRlT2JqZWN0c1xuICogQHBhcmFtIHsqfSBoYXNDb2xvcnNcbiAqIEByZXR1cm4ge1N0cmluZ31cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHByaW50TWVzc2FnZSh0eXBlLCBtc2csIHRlbXBsYXRlT2JqZWN0cywgaGFzQ29sb3JzKSB7XG4gIGlmICh0eXBlb2YgdHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICB0eXBlID0gY2FsY3VsYXRlTGV2ZWwodHlwZSk7XG4gIH1cblxuICBjb25zdCBmaW5hbE1lc3NhZ2UgPSBmaWxsSW5Nc2dUZW1wbGF0ZShtc2csIHRlbXBsYXRlT2JqZWN0cywgaGFzQ29sb3JzKTtcblxuICBjb25zdCBzdWIgPSBzdWJzeXN0ZW1zW2hhc0NvbG9ycyA/IDAgOiAxXVt0ZW1wbGF0ZU9iamVjdHMuc3ViXSB8fCBzdWJzeXN0ZW1zWyshaGFzQ29sb3JzXS5kZWZhdWx0O1xuICBpZiAoaGFzQ29sb3JzKSB7XG4gICAgcmV0dXJuIGAgJHtsZXZlbHNbdHlwZV0ocGFkKHR5cGUsIExFVkVMX1ZBTFVFX01BWCkpfSR7d2hpdGUoYCR7c3VifSAke2ZpbmFsTWVzc2FnZX1gKX1gO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBgICR7cGFkKHR5cGUsIExFVkVMX1ZBTFVFX01BWCl9JHtzdWJ9ICR7ZmluYWxNZXNzYWdlfWA7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGZpbGxJbk1zZ1RlbXBsYXRlKG1zZywgb2JqOiB1bmtub3duLCBjb2xvcnMpOiBzdHJpbmcge1xuICByZXR1cm4gbXNnLnJlcGxhY2UoL0B7KCE/WyRBLVphLXpfXVskMC05QS1aYS16XFwuX10qKX0vZywgKF8sIG5hbWUpOiBzdHJpbmcgPT4ge1xuXG4gICAgbGV0IHN0ciA9IG9iajtcbiAgICBsZXQgaXNfZXJyb3I7XG4gICAgaWYgKG5hbWVbMF0gPT09ICchJykge1xuICAgICAgbmFtZSA9IG5hbWUuc3Vic3RyKDEpO1xuICAgICAgaXNfZXJyb3IgPSB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IF9yZWYgPSBuYW1lLnNwbGl0KCcuJyk7XG4gICAgZm9yIChsZXQgX2kgPSAwOyBfaSA8IF9yZWYubGVuZ3RoOyBfaSsrKSB7XG4gICAgICBjb25zdCBpZCA9IF9yZWZbX2ldO1xuICAgICAgaWYgKGlzT2JqZWN0KHN0cikpIHtcbiAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICBzdHIgPSBzdHJbaWRdO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3RyID0gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmICh0eXBlb2Ygc3RyID09PSAnc3RyaW5nJykge1xuICAgICAgaWYgKCFjb2xvcnMgfHwgKHN0ciBhcyBzdHJpbmcpLmluY2x1ZGVzKCdcXG4nKSkge1xuICAgICAgICByZXR1cm4gc3RyO1xuICAgICAgfSBlbHNlIGlmIChpc19lcnJvcikge1xuICAgICAgICByZXR1cm4gcmVkKHN0cik7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZ3JlZW4oc3RyKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGluc3BlY3Qoc3RyLCB1bmRlZmluZWQsIG51bGwsIGNvbG9ycyk7XG4gICAgfVxuICB9KTtcbn1cbiJdfQ==