"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.match = match;
exports.setSecurityWebHeaders = setSecurityWebHeaders;
exports.validateName = validateName;
exports.validatePackage = validatePackage;
exports.media = media;
exports.encodeScopePackage = encodeScopePackage;
exports.expectJson = expectJson;
exports.antiLoop = antiLoop;
exports.allow = allow;
exports.final = final;
exports.log = log;
exports.errorReportingMiddleware = errorReportingMiddleware;
exports.LOG_VERDACCIO_BYTES = exports.LOG_VERDACCIO_ERROR = exports.LOG_STATUS_MESSAGE = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

var _utils = require("../lib/utils");

var _constants = require("../lib/constants");

var _cryptoUtils = require("../lib/crypto-utils");

var _logger = require("../lib/logger");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function match(regexp) {
  return function (req, res, next, value) {
    if (regexp.exec(value)) {
      next();
    } else {
      next('route');
    }
  };
}

function setSecurityWebHeaders(req, res, next) {
  // disable loading in frames (clickjacking, etc.)
  res.header(_constants.HEADERS.FRAMES_OPTIONS, 'deny'); // avoid stablish connections outside of domain

  res.header(_constants.HEADERS.CSP, "connect-src 'self'"); // https://stackoverflow.com/questions/18337630/what-is-x-content-type-options-nosniff

  res.header(_constants.HEADERS.CTO, 'nosniff'); // https://stackoverflow.com/questions/9090577/what-is-the-http-header-x-xss-protection

  res.header(_constants.HEADERS.XSS, '1; mode=block');
  next();
} // flow: express does not match properly
// flow info https://github.com/flowtype/flow-typed/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+express


function validateName(req, res, next, value, name) {
  if (value.charAt(0) === '-') {
    // special case in couchdb usually
    next('route');
  } else if ((0, _utils.validateName)(value)) {
    next();
  } else {
    next(_utils.ErrorCode.getForbidden('invalid ' + name));
  }
} // flow: express does not match properly
// flow info https://github.com/flowtype/flow-typed/issues?utf8=%E2%9C%93&q=is%3Aissue+is%3Aopen+express


function validatePackage(req, res, next, value, name) {
  if (value.charAt(0) === '-') {
    // special case in couchdb usually
    next('route');
  } else if ((0, _utils.validatePackage)(value)) {
    next();
  } else {
    next(_utils.ErrorCode.getForbidden('invalid ' + name));
  }
}

function media(expect) {
  return function (req, res, next) {
    if (req.headers[_constants.HEADER_TYPE.CONTENT_TYPE] !== expect) {
      next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.UNSUPPORTED_MEDIA, 'wrong content-type, expect: ' + expect + ', got: ' + req.headers[_constants.HEADER_TYPE.CONTENT_TYPE]));
    } else {
      next();
    }
  };
}

function encodeScopePackage(req, res, next) {
  if (req.url.indexOf('@') !== -1) {
    // e.g.: /@org/pkg/1.2.3 -> /@org%2Fpkg/1.2.3, /@org%2Fpkg/1.2.3 -> /@org%2Fpkg/1.2.3
    req.url = req.url.replace(/^(\/@[^\/%]+)\/(?!$)/, '$1%2F');
  }

  next();
}

function expectJson(req, res, next) {
  if (!(0, _utils.isObject)(req.body)) {
    return next(_utils.ErrorCode.getBadRequest("can't parse incoming json"));
  }

  next();
}

function antiLoop(config) {
  return function (req, res, next) {
    if (req.headers.via != null) {
      const arr = req.headers.via.split(',');

      for (let i = 0; i < arr.length; i++) {
        const m = arr[i].match(/\s*(\S+)\s+(\S+)/);

        if (m && m[2] === config.server_id) {
          return next(_utils.ErrorCode.getCode(_constants.HTTP_STATUS.LOOP_DETECTED, 'loop detected'));
        }
      }
    }

    next();
  };
}

function allow(auth) {
  return function (action) {
    return function (req, res, next) {
      req.pause();
      const packageName = req.params.scope ? `@${req.params.scope}/${req.params.package}` : req.params.package;
      const packageVersion = req.params.filename ? (0, _utils.getVersionFromTarball)(req.params.filename) : undefined;
      const remote = req.remote_user;

      _logger.logger.trace({
        action,
        user: remote.name
      }, `[middleware/allow][@{action}] allow for @{user}`);

      auth['allow_' + action]({
        packageName,
        packageVersion
      }, remote, function (error, allowed) {
        req.resume();

        if (error) {
          next(error);
        } else if (allowed) {
          next();
        } else {
          // last plugin (that's our built-in one) returns either
          // cb(err) or cb(null, true), so this should never happen
          throw _utils.ErrorCode.getInternalError(_constants.API_ERROR.PLUGIN_ERROR);
        }
      });
    };
  };
}

function final(body, req, res, next) {
  if (res.statusCode === _constants.HTTP_STATUS.UNAUTHORIZED && !res.getHeader(_constants.HEADERS.WWW_AUTH)) {
    // they say it's required for 401, so...
    res.header(_constants.HEADERS.WWW_AUTH, `${_constants.TOKEN_BASIC}, ${_constants.TOKEN_BEARER}`);
  }

  try {
    if (_lodash.default.isString(body) || _lodash.default.isObject(body)) {
      if (!res.getHeader(_constants.HEADERS.CONTENT_TYPE)) {
        res.header(_constants.HEADERS.CONTENT_TYPE, _constants.HEADERS.JSON);
      }

      if (typeof body === 'object' && _lodash.default.isNil(body) === false) {
        if (typeof body.error === 'string') {
          res._verdaccio_error = body.error;
        }

        body = JSON.stringify(body, undefined, '  ') + '\n';
      } // don't send etags with errors


      if (!res.statusCode || res.statusCode >= _constants.HTTP_STATUS.OK && res.statusCode < _constants.HTTP_STATUS.MULTIPLE_CHOICES) {
        res.header(_constants.HEADERS.ETAG, '"' + (0, _cryptoUtils.stringToMD5)(body) + '"');
      }
    } else {// send(null), send(204), etc.
    }
  } catch (err) {
    // if verdaccio sends headers first, and then calls res.send()
    // as an error handler, we can't report error properly,
    // and should just close socket
    if (err.message.match(/set headers after they are sent/)) {
      if (_lodash.default.isNil(res.socket) === false) {
        res.socket.destroy();
      }

      return;
    } else {
      throw err;
    }
  }

  res.send(body);
}

const LOG_STATUS_MESSAGE = "@{status}, user: @{user}(@{remoteIP}), req: '@{request.method} @{request.url}'";
exports.LOG_STATUS_MESSAGE = LOG_STATUS_MESSAGE;
const LOG_VERDACCIO_ERROR = `${LOG_STATUS_MESSAGE}, error: @{!error}`;
exports.LOG_VERDACCIO_ERROR = LOG_VERDACCIO_ERROR;
const LOG_VERDACCIO_BYTES = `${LOG_STATUS_MESSAGE}, bytes: @{bytes.in}/@{bytes.out}`;
exports.LOG_VERDACCIO_BYTES = LOG_VERDACCIO_BYTES;

function log(req, res, next) {
  // logger
  req.log = _logger.logger.child({
    sub: 'in'
  });
  const _auth = req.headers.authorization;

  if (_lodash.default.isNil(_auth) === false) {
    req.headers.authorization = '<Classified>';
  }

  const _cookie = req.headers.cookie;

  if (_lodash.default.isNil(_cookie) === false) {
    req.headers.cookie = '<Classified>';
  }

  req.url = req.originalUrl;
  req.log.info({
    req: req,
    ip: req.ip
  }, "@{ip} requested '@{req.method} @{req.url}'");
  req.originalUrl = req.url;

  if (_lodash.default.isNil(_auth) === false) {
    req.headers.authorization = _auth;
  }

  if (_lodash.default.isNil(_cookie) === false) {
    req.headers.cookie = _cookie;
  }

  let bytesin = 0;
  req.on('data', function (chunk) {
    bytesin += chunk.length;
  });
  let bytesout = 0;
  const _write = res.write; // FIXME: res.write should return boolean
  // @ts-ignore

  res.write = function (buf) {
    bytesout += buf.length;
    /* eslint prefer-rest-params: "off" */
    // @ts-ignore

    _write.apply(res, arguments);
  };

  const log = function () {
    const forwardedFor = req.headers['x-forwarded-for'];
    const remoteAddress = req.connection.remoteAddress;
    const remoteIP = forwardedFor ? `${forwardedFor} via ${remoteAddress}` : remoteAddress;
    let message;

    if (res._verdaccio_error) {
      message = LOG_VERDACCIO_ERROR;
    } else {
      message = LOG_VERDACCIO_BYTES;
    }

    req.url = req.originalUrl;
    req.log.warn({
      request: {
        method: req.method,
        url: req.url
      },
      level: 35,
      // http
      user: req.remote_user && req.remote_user.name || null,
      remoteIP,
      status: res.statusCode,
      error: res._verdaccio_error,
      bytes: {
        in: bytesin,
        out: bytesout
      }
    }, message);
    req.originalUrl = req.url;
  };

  req.on('close', function () {
    log();
  });
  const _end = res.end;

  res.end = function (buf) {
    if (buf) {
      bytesout += buf.length;
    }
    /* eslint prefer-rest-params: "off" */
    // @ts-ignore


    _end.apply(res, arguments);

    log();
  };

  next();
} // Middleware


function errorReportingMiddleware(req, res, next) {
  res.report_error = res.report_error || function (err) {
    if (err.status && err.status >= _constants.HTTP_STATUS.BAD_REQUEST && err.status < 600) {
      if (_lodash.default.isNil(res.headersSent) === false) {
        res.status(err.status);
        next({
          error: err.message || _constants.API_ERROR.UNKNOWN_ERROR
        });
      }
    } else {
      _logger.logger.error({
        err: err
      }, 'unexpected error: @{!err.message}\n@{err.stack}');

      if (!res.status || !res.send) {
        _logger.logger.error('this is an error in express.js, please report this');

        res.destroy();
      } else if (!res.headersSent) {
        res.status(_constants.HTTP_STATUS.INTERNAL_ERROR);
        next({
          error: _constants.API_ERROR.INTERNAL_SERVER_ERROR
        });
      } else {// socket should be already closed
      }
    }
  };

  next();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcGkvbWlkZGxld2FyZS50cyJdLCJuYW1lcyI6WyJtYXRjaCIsInJlZ2V4cCIsInJlcSIsInJlcyIsIm5leHQiLCJ2YWx1ZSIsImV4ZWMiLCJzZXRTZWN1cml0eVdlYkhlYWRlcnMiLCJoZWFkZXIiLCJIRUFERVJTIiwiRlJBTUVTX09QVElPTlMiLCJDU1AiLCJDVE8iLCJYU1MiLCJ2YWxpZGF0ZU5hbWUiLCJuYW1lIiwiY2hhckF0IiwiRXJyb3JDb2RlIiwiZ2V0Rm9yYmlkZGVuIiwidmFsaWRhdGVQYWNrYWdlIiwibWVkaWEiLCJleHBlY3QiLCJoZWFkZXJzIiwiSEVBREVSX1RZUEUiLCJDT05URU5UX1RZUEUiLCJnZXRDb2RlIiwiSFRUUF9TVEFUVVMiLCJVTlNVUFBPUlRFRF9NRURJQSIsImVuY29kZVNjb3BlUGFja2FnZSIsInVybCIsImluZGV4T2YiLCJyZXBsYWNlIiwiZXhwZWN0SnNvbiIsImJvZHkiLCJnZXRCYWRSZXF1ZXN0IiwiYW50aUxvb3AiLCJjb25maWciLCJ2aWEiLCJhcnIiLCJzcGxpdCIsImkiLCJsZW5ndGgiLCJtIiwic2VydmVyX2lkIiwiTE9PUF9ERVRFQ1RFRCIsImFsbG93IiwiYXV0aCIsImFjdGlvbiIsInBhdXNlIiwicGFja2FnZU5hbWUiLCJwYXJhbXMiLCJzY29wZSIsInBhY2thZ2UiLCJwYWNrYWdlVmVyc2lvbiIsImZpbGVuYW1lIiwidW5kZWZpbmVkIiwicmVtb3RlIiwicmVtb3RlX3VzZXIiLCJsb2dnZXIiLCJ0cmFjZSIsInVzZXIiLCJlcnJvciIsImFsbG93ZWQiLCJyZXN1bWUiLCJnZXRJbnRlcm5hbEVycm9yIiwiQVBJX0VSUk9SIiwiUExVR0lOX0VSUk9SIiwiZmluYWwiLCJzdGF0dXNDb2RlIiwiVU5BVVRIT1JJWkVEIiwiZ2V0SGVhZGVyIiwiV1dXX0FVVEgiLCJUT0tFTl9CQVNJQyIsIlRPS0VOX0JFQVJFUiIsIl8iLCJpc1N0cmluZyIsImlzT2JqZWN0IiwiSlNPTiIsImlzTmlsIiwiX3ZlcmRhY2Npb19lcnJvciIsInN0cmluZ2lmeSIsIk9LIiwiTVVMVElQTEVfQ0hPSUNFUyIsIkVUQUciLCJlcnIiLCJtZXNzYWdlIiwic29ja2V0IiwiZGVzdHJveSIsInNlbmQiLCJMT0dfU1RBVFVTX01FU1NBR0UiLCJMT0dfVkVSREFDQ0lPX0VSUk9SIiwiTE9HX1ZFUkRBQ0NJT19CWVRFUyIsImxvZyIsImNoaWxkIiwic3ViIiwiX2F1dGgiLCJhdXRob3JpemF0aW9uIiwiX2Nvb2tpZSIsImNvb2tpZSIsIm9yaWdpbmFsVXJsIiwiaW5mbyIsImlwIiwiYnl0ZXNpbiIsIm9uIiwiY2h1bmsiLCJieXRlc291dCIsIl93cml0ZSIsIndyaXRlIiwiYnVmIiwiYXBwbHkiLCJhcmd1bWVudHMiLCJmb3J3YXJkZWRGb3IiLCJyZW1vdGVBZGRyZXNzIiwiY29ubmVjdGlvbiIsInJlbW90ZUlQIiwid2FybiIsInJlcXVlc3QiLCJtZXRob2QiLCJsZXZlbCIsInN0YXR1cyIsImJ5dGVzIiwiaW4iLCJvdXQiLCJfZW5kIiwiZW5kIiwiZXJyb3JSZXBvcnRpbmdNaWRkbGV3YXJlIiwicmVwb3J0X2Vycm9yIiwiQkFEX1JFUVVFU1QiLCJoZWFkZXJzU2VudCIsIlVOS05PV05fRVJST1IiLCJJTlRFUk5BTF9FUlJPUiIsIklOVEVSTkFMX1NFUlZFUl9FUlJPUiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUVBOztBQUNBOztBQUNBOztBQUdBOzs7O0FBR08sU0FBU0EsS0FBVCxDQUFlQyxNQUFmLEVBQW9DO0FBQ3pDLFNBQU8sVUFBU0MsR0FBVCxFQUE4QkMsR0FBOUIsRUFBb0RDLElBQXBELEVBQTRFQyxLQUE1RSxFQUFpRztBQUN0RyxRQUFJSixNQUFNLENBQUNLLElBQVAsQ0FBWUQsS0FBWixDQUFKLEVBQXdCO0FBQ3RCRCxNQUFBQSxJQUFJO0FBQ0wsS0FGRCxNQUVPO0FBQ0xBLE1BQUFBLElBQUksQ0FBQyxPQUFELENBQUo7QUFDRDtBQUNGLEdBTkQ7QUFPRDs7QUFFTSxTQUFT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QUFLLEVBQUV1QixHQUFHLENBQUNDLE9BQUosSUFBZXBCLHFCQUFVZ0U7QUFBbEMsU0FBRCxDQUFKO0FBQ0Q7QUFDRixLQUxELE1BS087QUFDTHZFLHFCQUFPRyxLQUFQLENBQWE7QUFBRXVCLFFBQUFBLEdBQUcsRUFBRUE7QUFBUCxPQUFiLEVBQTJCLGlEQUEzQjs7QUFDQSxVQUFJLENBQUNqRixHQUFHLENBQUNvSCxNQUFMLElBQWUsQ0FBQ3BILEdBQUcsQ0FBQ3FGLElBQXhCLEVBQThCO0FBQzVCOUIsdUJBQU9HLEtBQVAsQ0FBYSxvREFBYjs7QUFDQTFELFFBQUFBLEdBQUcsQ0FBQ29GLE9BQUo7QUFDRCxPQUhELE1BR08sSUFBSSxDQUFDcEYsR0FBRyxDQUFDNkgsV0FBVCxFQUFzQjtBQUMzQjdILFFBQUFBLEdBQUcsQ0FBQ29ILE1BQUosQ0FBVzdGLHVCQUFZd0csY0FBdkI7QUFDQTlILFFBQUFBLElBQUksQ0FBQztBQUFFeUQsVUFBQUEsS0FBSyxFQUFFSSxxQkFBVWtFO0FBQW5CLFNBQUQsQ0FBSjtBQUNELE9BSE0sTUFHQSxDQUNMO0FBQ0Q7QUFDRjtBQUNGLEdBcEJIOztBQXNCQS9ILEVBQUFBLElBQUk7QUFDTCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5cbmltcG9ydCB7IHZhbGlkYXRlTmFtZSBhcyB1dGlsVmFsaWRhdGVOYW1lLCB2YWxpZGF0ZVBhY2thZ2UgYXMgdXRpbFZhbGlkYXRlUGFja2FnZSwgZ2V0VmVyc2lvbkZyb21UYXJiYWxsLCBpc09iamVjdCwgRXJyb3JDb2RlIH0gZnJvbSAnLi4vbGliL3V0aWxzJztcbmltcG9ydCB7IEFQSV9FUlJPUiwgSEVBREVSX1RZUEUsIEhFQURFUlMsIEhUVFBfU1RBVFVTLCBUT0tFTl9CQVNJQywgVE9LRU5fQkVBUkVSIH0gZnJvbSAnLi4vbGliL2NvbnN0YW50cyc7XG5pbXBvcnQgeyBzdHJpbmdUb01ENSB9IGZyb20gJy4uL2xpYi9jcnlwdG8tdXRpbHMnO1xuaW1wb3J0IHsgJFJlc3BvbnNlRXh0ZW5kLCAkUmVxdWVzdEV4dGVuZCwgJE5leHRGdW5jdGlvblZlciwgSUF1dGggfSBmcm9tICcuLi8uLi90eXBlcyc7XG5pbXBvcnQgeyBDb25maWcsIFBhY2thZ2UsIFJlbW90ZVVzZXIgfSBmcm9tICdAdmVyZGFjY2lvL3R5cGVzJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4uL2xpYi9sb2dnZXInO1xuaW1wb3J0IHsgVmVyZGFjY2lvRXJyb3IgfSBmcm9tICdAdmVyZGFjY2lvL2NvbW1vbnMtYXBpJztcblxuZXhwb3J0IGZ1bmN0aW9uIG1hdGNoKHJlZ2V4cDogUmVnRXhwKTogYW55IHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyLCB2YWx1ZTogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKHJlZ2V4cC5leGVjKHZhbHVlKSkge1xuICAgICAgbmV4dCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0KCdyb3V0ZScpO1xuICAgIH1cbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNldFNlY3VyaXR5V2ViSGVhZGVycyhyZXE6ICRSZXF1ZXN0RXh0ZW5kLCByZXM6ICRSZXNwb25zZUV4dGVuZCwgbmV4dDogJE5leHRGdW5jdGlvblZlcik6IHZvaWQge1xuICAvLyBkaXNhYmxlIGxvYWRpbmcgaW4gZnJhbWVzIChjbGlja2phY2tpbmcsIGV0Yy4pXG4gIHJlcy5oZWFkZXIoSEVBREVSUy5GUkFNRVNfT1BUSU9OUywgJ2RlbnknKTtcbiAgLy8gYXZvaWQgc3RhYmxpc2ggY29ubmVjdGlvbnMgb3V0c2lkZSBvZiBkb21haW5cbiAgcmVzLmhlYWRlcihIRUFERVJTLkNTUCwgXCJjb25uZWN0LXNyYyAnc2VsZidcIik7XG4gIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzE4MzM3NjMwL3doYXQtaXMteC1jb250ZW50LXR5cGUtb3B0aW9ucy1ub3NuaWZmXG4gIHJlcy5oZWFkZXIoSEVBREVSUy5DVE8sICdub3NuaWZmJyk7XG4gIC8vIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzkwOTA1Nzcvd2hhdC1pcy10aGUtaHR0cC1oZWFkZXIteC14c3MtcHJvdGVjdGlvblxuICByZXMuaGVhZGVyKEhFQURFUlMuWFNTLCAnMTsgbW9kZT1ibG9jaycpO1xuICBuZXh0KCk7XG59XG5cbi8vIGZsb3c6IGV4cHJlc3MgZG9lcyBub3QgbWF0Y2ggcHJvcGVybHlcbi8vIGZsb3cgaW5mbyBodHRwczovL2dpdGh1Yi5jb20vZmxvd3R5cGUvZmxvdy10eXBlZC9pc3N1ZXM/dXRmOD0lRTIlOUMlOTMmcT1pcyUzQWlzc3VlK2lzJTNBb3BlbitleHByZXNzXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVOYW1lKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyLCB2YWx1ZTogc3RyaW5nLCBuYW1lOiBzdHJpbmcpOiB2b2lkIHtcbiAgaWYgKHZhbHVlLmNoYXJBdCgwKSA9PT0gJy0nKSB7XG4gICAgLy8gc3BlY2lhbCBjYXNlIGluIGNvdWNoZGIgdXN1YWxseVxuICAgIG5leHQoJ3JvdXRlJyk7XG4gIH0gZWxzZSBpZiAodXRpbFZhbGlkYXRlTmFtZSh2YWx1ZSkpIHtcbiAgICBuZXh0KCk7XG4gIH0gZWxzZSB7XG4gICAgbmV4dChFcnJvckNvZGUuZ2V0Rm9yYmlkZGVuKCdpbnZhbGlkICcgKyBuYW1lKSk7XG4gIH1cbn1cblxuLy8gZmxvdzogZXhwcmVzcyBkb2VzIG5vdCBtYXRjaCBwcm9wZXJseVxuLy8gZmxvdyBpbmZvIGh0dHBzOi8vZ2l0aHViLmNvbS9mbG93dHlwZS9mbG93LXR5cGVkL2lzc3Vlcz91dGY4PSVFMiU5QyU5MyZxPWlzJTNBaXNzdWUraXMlM0FvcGVuK2V4cHJlc3NcbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVBhY2thZ2UocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIsIHZhbHVlOiBzdHJpbmcsIG5hbWU6IHN0cmluZyk6IHZvaWQge1xuICBpZiAodmFsdWUuY2hhckF0KDApID09PSAnLScpIHtcbiAgICAvLyBzcGVjaWFsIGNhc2UgaW4gY291Y2hkYiB1c3VhbGx5XG4gICAgbmV4dCgncm91dGUnKTtcbiAgfSBlbHNlIGlmICh1dGlsVmFsaWRhdGVQYWNrYWdlKHZhbHVlKSkge1xuICAgIG5leHQoKTtcbiAgfSBlbHNlIHtcbiAgICBuZXh0KEVycm9yQ29kZS5nZXRGb3JiaWRkZW4oJ2ludmFsaWQgJyArIG5hbWUpKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gbWVkaWEoZXhwZWN0OiBzdHJpbmcgfCBudWxsKTogYW55IHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgaWYgKHJlcS5oZWFkZXJzW0hFQURFUl9UWVBFLkNPTlRFTlRfVFlQRV0gIT09IGV4cGVjdCkge1xuICAgICAgbmV4dChFcnJvckNvZGUuZ2V0Q29kZShIVFRQX1NUQVRVUy5VTlNVUFBPUlRFRF9NRURJQSwgJ3dyb25nIGNvbnRlbnQtdHlwZSwgZXhwZWN0OiAnICsgZXhwZWN0ICsgJywgZ290OiAnICsgcmVxLmhlYWRlcnNbSEVBREVSX1RZUEUuQ09OVEVOVF9UWVBFXSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXh0KCk7XG4gICAgfVxuICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5jb2RlU2NvcGVQYWNrYWdlKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gIGlmIChyZXEudXJsLmluZGV4T2YoJ0AnKSAhPT0gLTEpIHtcbiAgICAvLyBlLmcuOiAvQG9yZy9wa2cvMS4yLjMgLT4gL0BvcmclMkZwa2cvMS4yLjMsIC9Ab3JnJTJGcGtnLzEuMi4zIC0+IC9Ab3JnJTJGcGtnLzEuMi4zXG4gICAgcmVxLnVybCA9IHJlcS51cmwucmVwbGFjZSgvXihcXC9AW15cXC8lXSspXFwvKD8hJCkvLCAnJDElMkYnKTtcbiAgfVxuICBuZXh0KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBleHBlY3RKc29uKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gIGlmICghaXNPYmplY3QocmVxLmJvZHkpKSB7XG4gICAgcmV0dXJuIG5leHQoRXJyb3JDb2RlLmdldEJhZFJlcXVlc3QoXCJjYW4ndCBwYXJzZSBpbmNvbWluZyBqc29uXCIpKTtcbiAgfVxuICBuZXh0KCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBhbnRpTG9vcChjb25maWc6IENvbmZpZyk6IEZ1bmN0aW9uIHtcbiAgcmV0dXJuIGZ1bmN0aW9uKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgaWYgKHJlcS5oZWFkZXJzLnZpYSAhPSBudWxsKSB7XG4gICAgICBjb25zdCBhcnIgPSByZXEuaGVhZGVycy52aWEuc3BsaXQoJywnKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBhcnIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgbSA9IGFycltpXS5tYXRjaCgvXFxzKihcXFMrKVxccysoXFxTKykvKTtcbiAgICAgICAgaWYgKG0gJiYgbVsyXSA9PT0gY29uZmlnLnNlcnZlcl9pZCkge1xuICAgICAgICAgIHJldHVybiBuZXh0KEVycm9yQ29kZS5nZXRDb2RlKEhUVFBfU1RBVFVTLkxPT1BfREVURUNURUQsICdsb29wIGRldGVjdGVkJykpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIG5leHQoKTtcbiAgfTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFsbG93KGF1dGg6IElBdXRoKTogRnVuY3Rpb24ge1xuICByZXR1cm4gZnVuY3Rpb24oYWN0aW9uOiBzdHJpbmcpOiBGdW5jdGlvbiB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gICAgICByZXEucGF1c2UoKTtcbiAgICAgIGNvbnN0IHBhY2thZ2VOYW1lID0gcmVxLnBhcmFtcy5zY29wZSA/IGBAJHtyZXEucGFyYW1zLnNjb3BlfS8ke3JlcS5wYXJhbXMucGFja2FnZX1gIDogcmVxLnBhcmFtcy5wYWNrYWdlO1xuICAgICAgY29uc3QgcGFja2FnZVZlcnNpb24gPSByZXEucGFyYW1zLmZpbGVuYW1lID8gZ2V0VmVyc2lvbkZyb21UYXJiYWxsKHJlcS5wYXJhbXMuZmlsZW5hbWUpIDogdW5kZWZpbmVkO1xuICAgICAgY29uc3QgcmVtb3RlOiBSZW1vdGVVc2VyID0gcmVxLnJlbW90ZV91c2VyO1xuICAgICAgbG9nZ2VyLnRyYWNlKHsgYWN0aW9uLCB1c2VyOiByZW1vdGUubmFtZSB9LCBgW21pZGRsZXdhcmUvYWxsb3ddW0B7YWN0aW9ufV0gYWxsb3cgZm9yIEB7dXNlcn1gKTtcblxuICAgICAgYXV0aFsnYWxsb3dfJyArIGFjdGlvbl0oeyBwYWNrYWdlTmFtZSwgcGFja2FnZVZlcnNpb24gfSwgcmVtb3RlLCBmdW5jdGlvbihlcnJvciwgYWxsb3dlZCk6IHZvaWQge1xuICAgICAgICByZXEucmVzdW1lKCk7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIG5leHQoZXJyb3IpO1xuICAgICAgICB9IGVsc2UgaWYgKGFsbG93ZWQpIHtcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbGFzdCBwbHVnaW4gKHRoYXQncyBvdXIgYnVpbHQtaW4gb25lKSByZXR1cm5zIGVpdGhlclxuICAgICAgICAgIC8vIGNiKGVycikgb3IgY2IobnVsbCwgdHJ1ZSksIHNvIHRoaXMgc2hvdWxkIG5ldmVyIGhhcHBlblxuICAgICAgICAgIHRocm93IEVycm9yQ29kZS5nZXRJbnRlcm5hbEVycm9yKEFQSV9FUlJPUi5QTFVHSU5fRVJST1IpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9O1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1pZGRsZXdhcmVFcnJvciB7XG4gIGVycm9yOiBzdHJpbmc7XG59XG5cbmV4cG9ydCB0eXBlIEZpbmFsQm9keSA9IFBhY2thZ2UgfCBNaWRkbGV3YXJlRXJyb3IgfCBzdHJpbmc7XG5cbmV4cG9ydCBmdW5jdGlvbiBmaW5hbChib2R5OiBGaW5hbEJvZHksIHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gIGlmIChyZXMuc3RhdHVzQ29kZSA9PT0gSFRUUF9TVEFUVVMuVU5BVVRIT1JJWkVEICYmICFyZXMuZ2V0SGVhZGVyKEhFQURFUlMuV1dXX0FVVEgpKSB7XG4gICAgLy8gdGhleSBzYXkgaXQncyByZXF1aXJlZCBmb3IgNDAxLCBzby4uLlxuICAgIHJlcy5oZWFkZXIoSEVBREVSUy5XV1dfQVVUSCwgYCR7VE9LRU5fQkFTSUN9LCAke1RPS0VOX0JFQVJFUn1gKTtcbiAgfVxuXG4gIHRyeSB7XG4gICAgaWYgKF8uaXNTdHJpbmcoYm9keSkgfHwgXy5pc09iamVjdChib2R5KSkge1xuICAgICAgaWYgKCFyZXMuZ2V0SGVhZGVyKEhFQURFUlMuQ09OVEVOVF9UWVBFKSkge1xuICAgICAgICByZXMuaGVhZGVyKEhFQURFUlMuQ09OVEVOVF9UWVBFLCBIRUFERVJTLkpTT04pO1xuICAgICAgfVxuXG4gICAgICBpZiAodHlwZW9mIGJvZHkgPT09ICdvYmplY3QnICYmIF8uaXNOaWwoYm9keSkgPT09IGZhbHNlKSB7XG4gICAgICAgIGlmICh0eXBlb2YgKGJvZHkgYXMgTWlkZGxld2FyZUVycm9yKS5lcnJvciA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICByZXMuX3ZlcmRhY2Npb19lcnJvciA9IChib2R5IGFzIE1pZGRsZXdhcmVFcnJvcikuZXJyb3I7XG4gICAgICAgIH1cbiAgICAgICAgYm9keSA9IEpTT04uc3RyaW5naWZ5KGJvZHksIHVuZGVmaW5lZCwgJyAgJykgKyAnXFxuJztcbiAgICAgIH1cblxuICAgICAgLy8gZG9uJ3Qgc2VuZCBldGFncyB3aXRoIGVycm9yc1xuICAgICAgaWYgKCFyZXMuc3RhdHVzQ29kZSB8fCAocmVzLnN0YXR1c0NvZGUgPj0gSFRUUF9TVEFUVVMuT0sgJiYgcmVzLnN0YXR1c0NvZGUgPCBIVFRQX1NUQVRVUy5NVUxUSVBMRV9DSE9JQ0VTKSkge1xuICAgICAgICByZXMuaGVhZGVyKEhFQURFUlMuRVRBRywgJ1wiJyArIHN0cmluZ1RvTUQ1KGJvZHkgYXMgc3RyaW5nKSArICdcIicpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBzZW5kKG51bGwpLCBzZW5kKDIwNCksIGV0Yy5cbiAgICB9XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIC8vIGlmIHZlcmRhY2NpbyBzZW5kcyBoZWFkZXJzIGZpcnN0LCBhbmQgdGhlbiBjYWxscyByZXMuc2VuZCgpXG4gICAgLy8gYXMgYW4gZXJyb3IgaGFuZGxlciwgd2UgY2FuJ3QgcmVwb3J0IGVycm9yIHByb3Blcmx5LFxuICAgIC8vIGFuZCBzaG91bGQganVzdCBjbG9zZSBzb2NrZXRcbiAgICBpZiAoZXJyLm1lc3NhZ2UubWF0Y2goL3NldCBoZWFkZXJzIGFmdGVyIHRoZXkgYXJlIHNlbnQvKSkge1xuICAgICAgaWYgKF8uaXNOaWwocmVzLnNvY2tldCkgPT09IGZhbHNlKSB7XG4gICAgICAgIHJlcy5zb2NrZXQuZGVzdHJveSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aHJvdyBlcnI7XG4gICAgfVxuICB9XG5cbiAgcmVzLnNlbmQoYm9keSk7XG59XG5cbmV4cG9ydCBjb25zdCBMT0dfU1RBVFVTX01FU1NBR0UgPSBcIkB7c3RhdHVzfSwgdXNlcjogQHt1c2VyfShAe3JlbW90ZUlQfSksIHJlcTogJ0B7cmVxdWVzdC5tZXRob2R9IEB7cmVxdWVzdC51cmx9J1wiO1xuZXhwb3J0IGNvbnN0IExPR19WRVJEQUNDSU9fRVJST1IgPSBgJHtMT0dfU1RBVFVTX01FU1NBR0V9LCBlcnJvcjogQHshZXJyb3J9YDtcbmV4cG9ydCBjb25zdCBMT0dfVkVSREFDQ0lPX0JZVEVTID0gYCR7TE9HX1NUQVRVU19NRVNTQUdFfSwgYnl0ZXM6IEB7Ynl0ZXMuaW59L0B7Ynl0ZXMub3V0fWA7XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2cocmVxOiAkUmVxdWVzdEV4dGVuZCwgcmVzOiAkUmVzcG9uc2VFeHRlbmQsIG5leHQ6ICROZXh0RnVuY3Rpb25WZXIpOiB2b2lkIHtcbiAgLy8gbG9nZ2VyXG4gIHJlcS5sb2cgPSBsb2dnZXIuY2hpbGQoeyBzdWI6ICdpbicgfSk7XG5cbiAgY29uc3QgX2F1dGggPSByZXEuaGVhZGVycy5hdXRob3JpemF0aW9uO1xuICBpZiAoXy5pc05pbChfYXV0aCkgPT09IGZhbHNlKSB7XG4gICAgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiA9ICc8Q2xhc3NpZmllZD4nO1xuICB9XG5cbiAgY29uc3QgX2Nvb2tpZSA9IHJlcS5oZWFkZXJzLmNvb2tpZTtcbiAgaWYgKF8uaXNOaWwoX2Nvb2tpZSkgPT09IGZhbHNlKSB7XG4gICAgcmVxLmhlYWRlcnMuY29va2llID0gJzxDbGFzc2lmaWVkPic7XG4gIH1cblxuICByZXEudXJsID0gcmVxLm9yaWdpbmFsVXJsO1xuICByZXEubG9nLmluZm8oeyByZXE6IHJlcSwgaXA6IHJlcS5pcCB9LCBcIkB7aXB9IHJlcXVlc3RlZCAnQHtyZXEubWV0aG9kfSBAe3JlcS51cmx9J1wiKTtcbiAgcmVxLm9yaWdpbmFsVXJsID0gcmVxLnVybDtcblxuICBpZiAoXy5pc05pbChfYXV0aCkgPT09IGZhbHNlKSB7XG4gICAgcmVxLmhlYWRlcnMuYXV0aG9yaXphdGlvbiA9IF9hdXRoO1xuICB9XG5cbiAgaWYgKF8uaXNOaWwoX2Nvb2tpZSkgPT09IGZhbHNlKSB7XG4gICAgcmVxLmhlYWRlcnMuY29va2llID0gX2Nvb2tpZTtcbiAgfVxuXG4gIGxldCBieXRlc2luID0gMDtcbiAgcmVxLm9uKCdkYXRhJywgZnVuY3Rpb24oY2h1bmspOiB2b2lkIHtcbiAgICBieXRlc2luICs9IGNodW5rLmxlbmd0aDtcbiAgfSk7XG5cbiAgbGV0IGJ5dGVzb3V0ID0gMDtcbiAgY29uc3QgX3dyaXRlID0gcmVzLndyaXRlO1xuICAvLyBGSVhNRTogcmVzLndyaXRlIHNob3VsZCByZXR1cm4gYm9vbGVhblxuICAvLyBAdHMtaWdub3JlXG4gIHJlcy53cml0ZSA9IGZ1bmN0aW9uKGJ1Zik6IGJvb2xlYW4ge1xuICAgIGJ5dGVzb3V0ICs9IGJ1Zi5sZW5ndGg7XG4gICAgLyogZXNsaW50IHByZWZlci1yZXN0LXBhcmFtczogXCJvZmZcIiAqL1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBfd3JpdGUuYXBwbHkocmVzLCBhcmd1bWVudHMpO1xuICB9O1xuXG4gIGNvbnN0IGxvZyA9IGZ1bmN0aW9uKCk6IHZvaWQge1xuICAgIGNvbnN0IGZvcndhcmRlZEZvciA9IHJlcS5oZWFkZXJzWyd4LWZvcndhcmRlZC1mb3InXTtcbiAgICBjb25zdCByZW1vdGVBZGRyZXNzID0gcmVxLmNvbm5lY3Rpb24ucmVtb3RlQWRkcmVzcztcbiAgICBjb25zdCByZW1vdGVJUCA9IGZvcndhcmRlZEZvciA/IGAke2ZvcndhcmRlZEZvcn0gdmlhICR7cmVtb3RlQWRkcmVzc31gIDogcmVtb3RlQWRkcmVzcztcbiAgICBsZXQgbWVzc2FnZTtcbiAgICBpZiAocmVzLl92ZXJkYWNjaW9fZXJyb3IpIHtcbiAgICAgIG1lc3NhZ2UgPSBMT0dfVkVSREFDQ0lPX0VSUk9SO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXNzYWdlID0gTE9HX1ZFUkRBQ0NJT19CWVRFUztcbiAgICB9XG5cbiAgICByZXEudXJsID0gcmVxLm9yaWdpbmFsVXJsO1xuICAgIHJlcS5sb2cud2FybihcbiAgICAgIHtcbiAgICAgICAgcmVxdWVzdDoge1xuICAgICAgICAgIG1ldGhvZDogcmVxLm1ldGhvZCxcbiAgICAgICAgICB1cmw6IHJlcS51cmwsXG4gICAgICAgIH0sXG4gICAgICAgIGxldmVsOiAzNSwgLy8gaHR0cFxuICAgICAgICB1c2VyOiAocmVxLnJlbW90ZV91c2VyICYmIHJlcS5yZW1vdGVfdXNlci5uYW1lKSB8fCBudWxsLFxuICAgICAgICByZW1vdGVJUCxcbiAgICAgICAgc3RhdHVzOiByZXMuc3RhdHVzQ29kZSxcbiAgICAgICAgZXJyb3I6IHJlcy5fdmVyZGFjY2lvX2Vycm9yLFxuICAgICAgICBieXRlczoge1xuICAgICAgICAgIGluOiBieXRlc2luLFxuICAgICAgICAgIG91dDogYnl0ZXNvdXQsXG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAgbWVzc2FnZVxuICAgICk7XG4gICAgcmVxLm9yaWdpbmFsVXJsID0gcmVxLnVybDtcbiAgfTtcblxuICByZXEub24oJ2Nsb3NlJywgZnVuY3Rpb24oKTogdm9pZCB7XG4gICAgbG9nKCk7XG4gIH0pO1xuXG4gIGNvbnN0IF9lbmQgPSByZXMuZW5kO1xuICByZXMuZW5kID0gZnVuY3Rpb24oYnVmKTogdm9pZCB7XG4gICAgaWYgKGJ1Zikge1xuICAgICAgYnl0ZXNvdXQgKz0gYnVmLmxlbmd0aDtcbiAgICB9XG4gICAgLyogZXNsaW50IHByZWZlci1yZXN0LXBhcmFtczogXCJvZmZcIiAqL1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBfZW5kLmFwcGx5KHJlcywgYXJndW1lbnRzKTtcbiAgICBsb2coKTtcbiAgfTtcbiAgbmV4dCgpO1xufVxuXG4vLyBNaWRkbGV3YXJlXG5leHBvcnQgZnVuY3Rpb24gZXJyb3JSZXBvcnRpbmdNaWRkbGV3YXJlKHJlcTogJFJlcXVlc3RFeHRlbmQsIHJlczogJFJlc3BvbnNlRXh0ZW5kLCBuZXh0OiAkTmV4dEZ1bmN0aW9uVmVyKTogdm9pZCB7XG4gIHJlcy5yZXBvcnRfZXJyb3IgPVxuICAgIHJlcy5yZXBvcnRfZXJyb3IgfHxcbiAgICBmdW5jdGlvbihlcnI6IFZlcmRhY2Npb0Vycm9yKTogdm9pZCB7XG4gICAgICBpZiAoZXJyLnN0YXR1cyAmJiBlcnIuc3RhdHVzID49IEhUVFBfU1RBVFVTLkJBRF9SRVFVRVNUICYmIGVyci5zdGF0dXMgPCA2MDApIHtcbiAgICAgICAgaWYgKF8uaXNOaWwocmVzLmhlYWRlcnNTZW50KSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICByZXMuc3RhdHVzKGVyci5zdGF0dXMpO1xuICAgICAgICAgIG5leHQoeyBlcnJvcjogZXJyLm1lc3NhZ2UgfHwgQVBJX0VSUk9SLlVOS05PV05fRVJST1IgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcih7IGVycjogZXJyIH0sICd1bmV4cGVjdGVkIGVycm9yOiBAeyFlcnIubWVzc2FnZX1cXG5Ae2Vyci5zdGFja30nKTtcbiAgICAgICAgaWYgKCFyZXMuc3RhdHVzIHx8ICFyZXMuc2VuZCkge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcigndGhpcyBpcyBhbiBlcnJvciBpbiBleHByZXNzLmpzLCBwbGVhc2UgcmVwb3J0IHRoaXMnKTtcbiAgICAgICAgICByZXMuZGVzdHJveSgpO1xuICAgICAgICB9IGVsc2UgaWYgKCFyZXMuaGVhZGVyc1NlbnQpIHtcbiAgICAgICAgICByZXMuc3RhdHVzKEhUVFBfU1RBVFVTLklOVEVSTkFMX0VSUk9SKTtcbiAgICAgICAgICBuZXh0KHsgZXJyb3I6IEFQSV9FUlJPUi5JTlRFUk5BTF9TRVJWRVJfRVJST1IgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gc29ja2V0IHNob3VsZCBiZSBhbHJlYWR5IGNsb3NlZFxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICBuZXh0KCk7XG59XG4iXX0=